import SEO from '../../components/SEO';
import { useState } from 'react';
import { Select } from '@sajari/react-components';

<SEO title="useSearch" description="useSearch provides a getter & setter for the current query." />

# useSearch

`useSearch` provides a getter & setter for the current query.

```js
import { useSearch } from '@sajari/react-hooks';
```

## Usage

Returns results for the current query. By default it will use the Variables and Pipeline from the context:

```jsx
// TODO: use Results component once done mapping with the response from backend
function Example() {
  const { results = [] } = useSearch();
  const { query, setQuery } = useQuery();

  return (
    <>
      <Combobox onChange={(value) => setQuery(value)} />
      {query && results.length > 0 && (
        <ul className="list-disc px-5 space-y-2 mt-5">
          {results.map(({ values: { title, id } }) => (
            <li key={id}>{title}</li>
          ))}
        </ul>
      )}
    </>
  );
}
```

### Set a basic string query

```jsx
function Example() {
  const [tabIndex, setTabIndex] = React.useState(0);
  const queries = ['phone', 'chair', 'macbook'];
  const { results = [], loading } = useSearch(queries[tabIndex]);

  return (
    <>
      <Tabs onChange={(index) => setTabIndex(index)}>
        <TabList>
          <Tab>Phone</Tab>
          <Tab>Chair</Tab>
          <Tab>Macbook</Tab>
        </TabList>
        <div>
          {loading && <p className="p-4">Searching...</p>}
          {!loading && results.length > 0 && (
            <ul className="list-disc px-5 space-y-2 mt-5">
              {results.map(({ values: { title, id } }) => (
                <li key={id}>{title}</li>
              ))}
            </ul>
          )}
        </div>
      </Tabs>
    </>
  );
}
```

### Optionally pass in Variables or Pipeline:

```jsx
function Example() {
  const pipeline = new Pipeline(
    {
      project: 'sajariptyltd',
      collection: 'sajari-com',
    },
    'website',
  );
  const variables = new Variables({ q: 'api', resultsPerPage: 1 });
  const fields = { title: 'name' };

  const SearchPlayground = React.memo(() => {
    const { results = [], loading } = useSearch({ variables, pipeline, fields });

    return (
      <div className="flex flex-col space-y-4">
        <div className="flex space-x-3 items-center">
          <p>PageSize</p>
          <Select
            onChange={(e) => {
              variables.set({ resultsPerPage: Number(e.target.value) });
            }}
          >
            <option value="1">1</option>
            <option value="3">3</option>
          </Select>
        </div>
        <div>
          {loading && <p>Searching...</p>}
          {!loading && results.length > 0 && (
            <ul className="list-disc px-5 space-y-2">
              {results.map(({ values: { title } }) => (
                <li key={title}>{title}</li>
              ))}
            </ul>
          )}
        </div>
      </div>
    );
  });

  return <SearchPlayground />;
}
```

## Anatomy

`useSearch` returns an object containing the following properties:

| Name           | Type                   | Default | Description                                                                               |
| -------------- | ---------------------- | ------- | ----------------------------------------------------------------------------------------- |
| `results`      | `Result[]`             |         | An array of results that met the query                                                    |
| `latency`      | `number`               |         | The engine latency                                                                        |
| `totalResults` | `number`               |         | The total count of results                                                                |
| `search`       | `(q?: string) => void` |         | The search method, call without param to resend the search request with the current query |
| `loading`      | `boolean`              |         | Is a search request being processed                                                       |
| `error`        | `Error` \| `null`      |         | The error encountered while searching                                                     |
